<%= page_title "Call list" %>
<%= render 'filter' %>

<table class="table table-strip">
  <thead>
    <tr>
      <td>Date</td>
      <td>PHD</td>
      <td>OD</td>
      <td>Phone</td>
      <td>Username</td>
      <td>Duration</td>

      <% @variables.each do |variable| %>
        <td style='color: gray;' > <%= variable.name %> </td>
      <% end %>

      <td>Action</td>
    </tr>
  </thead>

  <tbody>
    <% @reports.each_with_index do |report, index| %>
      <tr>
        <td> <%= timeago_tag(report.called_at) %></td>
        <td> <%= link_to(report.phd.name, users_path(place_id: report.phd.try(:id))) if report.phd %> </td>
        <td> <%= link_to(report.od.name, users_path(place_id: report.od.try(:id))) if report.od %> </td>
        <td> <%= report.phone %></td>
        <td> <%= report.user.try(:name)%> </td>
        <td> <%= report.duration%> </td>

        <% @variables.each do |variable| %>
          <td style='color: gray;'>
            <% report_variable = report.report_variables.select{|report_variable| report_variable.variable_id == variable.id}.first %>
            <% if report_variable %>
                <%= display_report_variable(report_variable) %>
            <% else %>
               <span class='gray'> </span>
            <% end %>
          </td>
        <% end %>


        <td>
          <%= link_to report_path(report), method: :delete, data: {confirm: 'Are you sure to delete ?'} do %>
              <i class='glyphicon glyphicon-trash'> </i>
          <% end %>

        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<div class="clearfix">
  <%= paginate_for(@reports) %>
</div>